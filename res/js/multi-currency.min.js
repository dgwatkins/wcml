jQuery(function(u){WCML_Multi_Currency={_currency_languages_saving:0,init:function(){u(document).ready(function(){WCML_Multi_Currency.setup_multi_currency_toggle(),u(document).on("change",".currency_code select",WCML_Multi_Currency.select_currency),u(document).on("click",".delete_currency",WCML_Multi_Currency.delete_currency),u(document).on("click",".wcml_currency_options .currency_options_save",WCML_Multi_Currency.save_currency),u(document).on("click",".js-display-tooltip",WCML_Multi_Currency.tooltip),u(document).on("click",".currency_languages a.otgs-ico-no",WCML_Multi_Currency.enable_currency_for_language),u(document).on("click",".currency_languages a.otgs-ico-yes",WCML_Multi_Currency.disable_currency_for_language),u(document).on("change",".default_currency select",WCML_Multi_Currency.change_default_currency),WCML_Multi_Currency.setup_currencies_sorting(),u(document).on("change",".currency_option_position",WCML_Multi_Currency.price_preview),u(document).on("change",".currency_option_thousand_sep",WCML_Multi_Currency.price_preview),u(document).on("change",".currency_option_decimal_sep",WCML_Multi_Currency.price_preview),u(document).on("change",".currency_option_decimals",WCML_Multi_Currency.price_preview),u(document).on("change",".currency_code select",WCML_Multi_Currency.price_preview),u(document).on("change",".wcml-gateways-enabled",WCML_Multi_Currency.display_gateways),u(document).on("change","#wcml_currency_options_gateway_code_paypal",WCML_Multi_Currency.preset_paypal_email),u(document).on("change","#wcml_currency_options_gateway_code_stripe",WCML_Multi_Currency.preset_stripe_settings),u(document).on("keypress",".currency_option_decimals",function(e){(8!=e.which&&0!=e.which&&e.which<48||57<e.which)&&e.preventDefault()}),u(document).on("keyup",".wcml-exchange-rate",WCML_Multi_Currency.exchange_rate_check),u("#wcml_mc_options").length&&(WCML_Multi_Currency.wcml_mc_form_submitted=!1,WCML_Multi_Currency.read_form_fields_status(),window.onbeforeunload=function(e){if(!WCML_Multi_Currency.wcml_mc_form_submitted&&WCML_Multi_Currency.form_fields_changed()||WCML_Multi_Currency.is_update_currency_lang_in_progress())return u("#wcml_warn_message").val()},u("#wcml_mc_options").on("submit",function(){WCML_Multi_Currency.wcml_mc_form_submitted=!0}))})},setup_multi_currency_toggle:function(){u("#multi_currency_independent").change(function(){"checked"==u(this).attr("checked")?u("#currency-switcher, #currency-switcher-widget, #currency-switcher-product, #multi-currency-per-language-details, #online-exchange-rates").fadeIn():u("#currency-switcher, #currency-switcher-widget, #currency-switcher-product, #multi-currency-per-language-details, #online-exchange-rates").fadeOut()})},select_currency:function(){var e=u(this).closest(".wcml_currency_options"),r=e.find(".wcml-dialog-close-button");r.attr("data-currency",u(this).val()),r.attr("data-symbol",u(this).find("option:selected").attr("data-symbol")),e.find(".this-currency").html(u(this).val())},delete_currency:function(e){e.preventDefault();var r=!1,c=u(this).data("currency"),n=u(this).data("currency_name"),t=u(this).data("currency_symbol");if(u(".currency_lang_table .wcml-row-currency-lang:first .currency_languages").each(function(){if(!WCML_Multi_Currency.check_currency_language(u(this).find("li").data("lang"),c))return!(r=!0)}),!r){u("#currency_row_"+c+" .currency_action_update").hide();var a=u('<span class="spinner" style="visibility: visible;margin:0;">');return u(this).hide(),u(this).parent().append(a).show(),u.ajax({type:"post",url:ajaxurl,data:{action:"wcml_delete_currency",wcml_nonce:u("#del_currency_nonce").val(),code:c},success:function(e){u("#currency_row_"+c).remove(),u("#currency_row_langs_"+c).remove(),u("#currency_row_del_"+c).remove(),u("#wcml_currencies_order .wcml_currencies_order_"+c).remove(),u("#wcml_currency_options_code_").prepend('<option data-symbol="'+t+'" value="'+c+'">'+n+"</option>"),u("#wcml_currency_options_code_").val(c).trigger("change"),u("#currency-lang-table").find("tr.default_currency select").each(function(){u(this).find("option[value='"+c+"']").remove()}),u(".wcml-ui-dialog").each(function(){WCML_Currency_Switcher_Settings.currency_switcher_preview(u(this))}),1==u(".wcml-row-currency").length&&(u("#online-exchange-rates-no-currencies").next().hide(),u("#online-exchange-rates-no-currencies").show())},done:function(){a.remove()}}),!1}},save_currency:function(){var t=u(this).closest(".wcml-dialog-container");if(WCML_Multi_Currency.check_on_numeric(t,".abstract_amount"))return!1;u(".wcml-currency-options-dialog :submit, .wcml-currency-options-dialog :button").prop("disabled",!0);var a=t.find('[name="currency_options[code]"]').val(),e=u('<span class="spinner" style="visibility:visible;position:absolute;margin-left:10px;"></span>');return e.show(),u(this).parent().prepend(e),u.ajax({url:ajaxurl,type:"POST",dataType:"json",data:t.find('[name^="currency_options"]').serialize()+"&action=wcml_save_currency&wcml_nonce="+jQuery("#wcml_save_currency_nonce").val(),success:function(e){if(t.find(".wcml-dialog-close-button").trigger("click"),u(".wcml-ui-dialog").each(function(){WCML_Currency_Switcher_Settings.currency_switcher_preview(u(this))}),0==u("#currency_row_"+a).length){(r=u("#currency-table tr.wcml-row-currency:last").clone()).attr("id","currency_row_"+a);var r,c=r.find(".wcml-col-edit a");c.attr("data-content","wcml_currency_options_"+a),c.attr("data-currency",a),c.data("dialog","wcml_currency_options_"+a),c.removeClass("hidden"),u("#currency-table").find("tr.default_currency").before(r),(r=u(".empty-currency-language-row").clone()).attr("id","currency_row_langs_"+a),u("#currency-lang-table").find("tr.default_currency").before(r),r.removeClass("hidden empty-currency-language-row"),r.find(".on a").each(function(){u(this).attr("data-currency",a),u(this).attr("title",u(this).attr("title").replace("%code%",e.currency_name)),u(this).attr("data-title-alt",u(this).attr("data-title-alt").replace("%code%",e.currency_name))}),u("#currency-lang-table").find("tr.default_currency select").each(function(){u(this).append('<option value="'+a+'">'+a+"</option>")}),u("#wcml_currencies_order").append('<li class="wcml_currencies_order_'+a+' ui-sortable-handle" cur="'+a+'">'+e.currency_name_formatted+"</li>"),(r=u("#currency-delete-table tr.wcml-row-currency-del:last").clone()).attr("id","currency_row_del_"+a);var n=r.find(".delete_currency");n.removeClass("hidden"),n.attr("data-currency",a),n.attr("data-currency_name",e.currency_name),n.attr("data-currency_symbol",e.currency_symbol),u("#currency-delete-table").find("tr.default_currency").before(r)}u("#currency_row_"+a+" .wcml-col-currency").html(e.currency_name_formatted),u("#currency_row_"+a+" .wcml-col-rate").html(e.currency_meta_info),u("#wcml_currency_options_"+a).remove(),u("#wcml_mc_options").before(e.currency_options),u('#wcml_currency_options_code_ option[value="'+a+'"]').remove(),u("#online-exchange-rates-no-currencies").is(":visible")&&(u("#online-exchange-rates-no-currencies").hide(),u("#online-exchange-rates-no-currencies").next().show())}}),!1},check_on_numeric:function(e,r){var c=u('<span class="wcml-error">');return WCML_Multi_Currency.is_number(e.find(r).val())?(0<e.find(r).parent().find(".wcml-error").size()&&e.find(r).parent().find(".wcml-error").remove(),!1):(0==e.find(r).parent().find(".wcml-error").size()&&(e.find(r).parent().append(c),c.text(e.find(r).data("message"))),!0)},tooltip:function(){var e=u(this);u(".wp-pointer").fadeOut(100),u(this).pointer({content:"<h3>"+e.data("header")+"</h3><p>"+e.data("content")+"</p>",position:{edge:"left",align:"center",offset:"15 0"}}).pointer("open")},enable_currency_for_language:function(e){if(WCML_Multi_Currency.is_update_currency_lang_in_progress())return!1;e.preventDefault(),u(this).addClass("spinner").removeClass("otgs-ico-no").css("visibility","visible");u(this).closest("tr")[0].rowIndex;u('.default_currency select[rel="'+u(this).data("language")+'"]').append('<option value="'+u(this).data("currency")+'">'+u(this).data("currency")+"</option>"),WCML_Multi_Currency.update_currency_lang(u(this),1,0);var r=u(this).data("title-alt");u(this).data("title-alt",u(this).attr("title")),u(this).attr("title",r)},disable_currency_for_language:function(e){if(WCML_Multi_Currency.is_update_currency_lang_in_progress())return!1;e.preventDefault(),u(this).addClass("spinner").removeClass("otgs-ico-yes").css("visibility","visible");var r=u(this).data("language");if(WCML_Multi_Currency.check_currency_language(r)){u(this).closest("tr")[0].rowIndex;u('.currency_languages select[rel="'+u(this).data("language")+'"]').val()==u(this).data("currency")?WCML_Multi_Currency.update_currency_lang(u(this),0,1):WCML_Multi_Currency.update_currency_lang(u(this),0,0),u('.default_currency select[rel="'+u(this).data("language")+'"] option[value="'+u(this).data("currency")+'"]').remove();var c=u(this).data("title-alt");u(this).data("title-alt",u(this).attr("title")),u(this).attr("title",c)}else u(this).removeClass("spinner").addClass("otgs-ico-yes")},check_currency_language:function(e,r){var c=u('#currency-lang-table a.otgs-ico-yes[data-language="'+e+'"]');return r&&(c=u('#currency-lang-table a.otgs-ico-yes[data-language="'+e+'"]').not(u('[data-currency="'+r+'"]'))),0!=c.length||(alert(u("#wcml_warn_disable_language_massage").val()),!1)},is_update_currency_lang_in_progress:function(){return void 0!==WCML_Multi_Currency._update_currency_lang_sync_flag&&1==WCML_Multi_Currency._update_currency_lang_sync_flag},set_update_currency_lang_in_progress:function(e){WCML_Multi_Currency._update_currency_lang_sync_flag=e},update_currency_lang:function(e,r,c){WCML_Multi_Currency._currency_languages_saving++,u("#wcml_mc_options :submit").attr("disabled","disabled"),u('input[name="wcml_mc_options"]').attr("disabled","disabled");var n=e.data("language"),t=e.data("currency");discard=!0,WCML_Multi_Currency.set_update_currency_lang_in_progress(1),u.ajax({type:"post",url:ajaxurl,data:{action:"wcml_update_currency_lang",value:r,lang:n,code:t,wcml_nonce:u("#update_currency_lang_nonce").val()},success:function(){c&&WCML_Multi_Currency.update_default_currency(n,0)},complete:function(){u('input[name="wcml_mc_options"]').removeAttr("disabled"),discard=!1,e.removeClass("spinner").css("visibility","visible"),r?e.addClass("otgs-ico-yes"):e.addClass("otgs-ico-no"),WCML_Multi_Currency._currency_languages_saving--,0==WCML_Multi_Currency._currency_languages_saving&&u("#wcml_mc_options :submit").removeAttr("disabled"),WCML_Multi_Currency.set_update_currency_lang_in_progress(0)}})},change_default_currency:function(){WCML_Multi_Currency.update_default_currency(u(this).attr("rel"),u(this).val(),u(this))},update_default_currency:function(e,r,c){if(u("#wcml_mc_options_submit").attr("disabled","disabled"),c){var n=u('<span class="spinner" style="visibility: visible;float:none;position: absolute">');c.parent().append(n)}discard=!0,u.ajax({type:"post",url:ajaxurl,data:{action:"wcml_update_default_currency",lang:e,code:r,wcml_nonce:u("#wcml_update_default_currency_nonce").val()},complete:function(){discard=!1,u("#wcml_mc_options_submit").removeAttr("disabled"),c&&c.parent().find(".spinner").remove()}})},is_number:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},setup_currencies_sorting:function(){u("#wcml_currencies_order").sortable({update:function(){var e=[];u("#wcml_currencies_order").find("li").each(function(){e.push(u(this).attr("cur"))}),u.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"wcml_currencies_order",wcml_nonce:u("#wcml_currencies_order_order_nonce").val(),order:e.join(";")},success:function(e){e.success&&(fadeInAjxResp(".wcml_currencies_order_ajx_resp",e.data.message),u(".wcml-ui-dialog").each(function(){WCML_Currency_Switcher_Settings.currency_switcher_preview(u(this))}))}})}})},price_preview:function(){var e=u(this).closest(".wcml_currency_options"),r=e.find(".currency_option_position").val(),c=e.find(".currency_option_thousand_sep").val(),n=(c=e.find(".currency_option_thousand_sep").val(),e.find(".currency_option_decimal_sep").val()),t=u(this).closest(".wcml_currency_options").find(".wcml-dialog-close-button").attr("data-symbol"),a="56789".substr(0,e.find(".currency_option_decimals").val());""==a&&(n="");var i="";switch(r){case"left":i="{symbol}1{thousand_sep}234{decimal_sep}{decimals}";break;case"right":i="1{thousand_sep}234{decimal_sep}{decimals}{symbol}";break;case"left_space":i="{symbol}&nbsp;1{thousand_sep}234{decimal_sep}{decimals}";break;case"right_space":i="1{thousand_sep}234{decimal_sep}{decimals}&nbsp;{symbol}"}var _=i.replace(/\{symbol\}/,t).replace(/\{thousand_sep\}/,c).replace(/\{decimal_sep\}/,n).replace(/\{decimals\}/,a);return e.find(".wcml-co-preview-value").html(_),!1},display_gateways:function(){"checked"==u(this).attr("checked")?u(".wcml-gateways").slideDown():u(".wcml-gateways").slideUp()},preset_paypal_email:function(){var e=u('input[name="currency_options[gateways_settings][paypal][value]"]'),r=u(".paypal-gateway-warning");e.val(u(this).find(":selected").data("email")),u(this).find(":selected").data("is-valid")?(r.hide(),e.removeAttr("readonly")):(r.show(),e.attr("readonly","readonly"))},preset_stripe_settings:function(){u('input[name="currency_options[gateways_settings][stripe][publishable_key]"]').val(u(this).find(":selected").data("publishable-key")),u('input[name="currency_options[gateways_settings][stripe][secret_key]"]').val(u(this).find(":selected").data("secret-key"))},read_form_fields_status:function(){this.mc_form_status=u("#wcml_mc_options").serialize()},form_fields_changed:function(){return this.mc_form_status!=u("#wcml_mc_options").serialize()},exchange_rate_check:function(e){if(void 0===r)var r={DOM_SUBTRACT:109,DOM_DASH:189,DOM_E:69};u(this).val()<=0||!WCML_Multi_Currency.is_number(u(this).val())||e.keyCode==r.DOM_SUBTRACT||e.keyCode==r.DOM_DASH||e.keyCode==r.DOM_E?(u(".wcml-co-set-rate .wcml-error").fadeIn(),u(".currency_options_save").attr("disabled","disabled")):(u(".wcml-co-set-rate .wcml-error").fadeOut(),u(".currency_options_save").removeAttr("disabled"))}},WCML_Multi_Currency.init()});