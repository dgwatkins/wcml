jQuery(function(a){WCML_Currency_Switcher_Settings={_currency_languages_saving:0,init:function(){a(document).ready(function(){a(document).on("change","#currency_switcher_style",WCML_Currency_Switcher_Settings.update_currency_switcher_style),a(document).on("click",".currency_switcher_save",WCML_Currency_Switcher_Settings.save_currency_switcher_settings),a(document).on("click",".delete_currency_switcher",WCML_Currency_Switcher_Settings.delete_currency_switcher),a(document).on("change",".js-wcml-cs-colorpicker-preset",WCML_Currency_Switcher_Settings.set_currency_switcher_color_pre_set),a(document).on("keyup",'input[name="wcml_curr_template"]',WCML_Currency_Switcher_Settings.setup_currency_switcher_template_keyup),a(document).on("change",'input[name="wcml_curr_template"]',WCML_Currency_Switcher_Settings.setup_currency_switcher_template_change),WCML_Currency_Switcher_Settings.open_dialog_from_hash()})},initColorPicker:function(){a(".wcml-ui-dialog .js-wcml-cs-panel-colors").find(".js-wcml-cs-colorpicker").wpColorPicker({change:function(b){var c=a(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(c)},clear:function(b){var c=a(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(c)}})},save_currency_switcher_settings:function(){var b=a(this).closest(".wcml-ui-dialog"),c=a('<span class="spinner" style="visibility: visible;">');a(this).parent().append(c),b.find(":submit,:button").prop("disabled",!0);var d=b.find('input[name="wcml_curr_template"]').val();d||(d=b.find("#currency_switcher_default").val());var e={};b.find("input.js-wcml-cs-colorpicker").each(function(){e[a(this).attr("name")]=a(this).val()});var f=b.find("#wcml-cs-widget option:selected").text(),g=b.find("#wcml_currencies_switcher_id").val(),h=b.find("#wcml-cs-widget").val(),i=b.find('input[name="wcml_cs_widget_title"]').val();a.ajax({type:"POST",dataType:"json",url:ajaxurl,data:{action:"wcml_currencies_switcher_save_settings",wcml_nonce:b.find("#wcml_currencies_switcher_save_settings_nonce").val(),switcher_id:g,widget_id:h,widget_title:i,switcher_style:b.find("#currency_switcher_style").val(),template:d,color_scheme:e},success:function(c){if(b.find(".ui-dialog-titlebar-close").trigger("click"),"undefined"==typeof h&&(h=g),0==a(".wcml-currency-preview."+h).length){var d=a(".wcml-cs-empty-row").clone();d.removeClass("wcml-cs-empty-row"),d.find(".wcml-currency-preview").addClass(h),d.find(".wcml-cs-widget-name").html(f),d.find(".edit_currency_switcher").attr("data-switcher",h),d.find(".edit_currency_switcher").attr("data-dialog","wcml_currency_switcher_options_"+h),d.find(".edit_currency_switcher").attr("data-content","wcml_currency_switcher_options_"+h),d.find(".delete_currency_switcher").attr("data-switcher",h),d.show(),a(".wcml-cs-list").find("tr.wcml-cs-empty-row").before(d)}WCML_Currency_Switcher_Settings.currency_switcher_preview(b,!0)}})},delete_currency_switcher:function(b){b.preventDefault();var c=a(this).data("switcher"),d=a(this).closest("tr"),e=a('<span class="spinner" style="visibility: visible;">');a(this).parent().html(e),a.ajax({type:"POST",dataType:"json",url:ajaxurl,data:{action:"wcml_delete_currency_switcher",wcml_nonce:a("#wcml_delete_currency_switcher_nonce").val(),switcher_id:c},success:function(a){d.hide()}})},currency_switcher_preview:_.debounce(function(b,c){var d=b.find('.wcml-dialog-container input[name="wcml_curr_template"]').val();d||(d=b.find(".wcml-dialog-container #currency_switcher_default").val());var e=a('<span class="spinner" style="visibility: visible;">');b.find(".wcml-dialog-container #wcml_curr_sel_preview").html(e);var f={};b.find("input.js-wcml-cs-colorpicker").each(function(){f[a(this).attr("name")]=a(this).val()});var g=b.find("#wcml_currencies_switcher_id").val(),h=b.find("#currency_switcher_style").val();a.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"wcml_currencies_switcher_preview",wcml_nonce:b.find("#wcml_currencies_switcher_preview_nonce").val(),switcher_id:g,switcher_style:h,template:d,color_scheme:f},success:function(d){0==a("#wcml-cs-inline-styles-"+g+"-"+h).length?a("#wcml-cs-inline-styles-"+g+"-"+h).html(d.inline_css):a("head").append('<style type="text/css" id="wcml-cs-inline-styles-'+g+"-"+h+'">'+d.inline_css+"</style>"),c?("new_widget"==g&&(g=b.find("#wcml-cs-widget").val()),a(".wcml-currency-preview."+g).html(d.preview)):b.find(".wcml-currency-preview").html(d.preview)}})},500),set_currency_switcher_color_pre_set:function(){var b=a(this).val(),c=a(this).closest(".wcml-ui-dialog");if("undefined"!=settings.pre_selected_colors[b]){var d,e=settings.pre_selected_colors[b];for(d in e)a('.wcml-ui-dialog input[name="'+d+'"]').val(e[d]),a('.wcml-ui-dialog input[name="'+d+'"]').closest(".wp-picker-container").find(".wp-color-result").css("background-color",e[d])}WCML_Currency_Switcher_Settings.currency_switcher_preview(c)},update_currency_switcher_style:function(b){var c=a(this).closest(".wcml-ui-dialog");WCML_Currency_Switcher_Settings.currency_switcher_preview(c)},setup_currency_switcher_template_keyup:function(b){var c=a(this).closest(".wcml-ui-dialog");discard=!0,a(this).closest(".wcml-section").find(".button-wrap input").css("border-color","#1e8cbe"),WCML_Currency_Switcher_Settings.currency_switcher_preview(c)},setup_currency_switcher_template_change:function(b){a(this).val()||a('input[name="wcml_curr_template"]').val(a("#currency_switcher_default").val())},open_dialog_from_hash:function(){var b=window.location.hash.substring(1).split("/"),c=b[0]||"",d=b[1]||"";"currency-switcher"==c&&(a('.edit_currency_switcher[data-switcher="'+d+'"]').trigger("click"),parent.location.hash="")}},WCML_Currency_Switcher_Settings.init()});